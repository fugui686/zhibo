import os
import base64
import sys
import time
import random
import requests
from openpyxl import Workbook
from datetime import datetime, timedelta
from PyQt5.QtGui import QFont, QPixmap, QIcon, QColor
from PyQt5.QtCore import QThreadPool, QDateTime, QByteArray, Qt, QSize, QTimer, QThread
from configparser import ConfigParser
from PyQt5.QtWidgets import QApplication, QMessageBox, QFileDialog, QDateTimeEdit, QLabel, QSizePolicy, \
    QListWidget, QStackedWidget, QProgressBar, QGroupBox, QGridLayout, QListWidgetItem, QFrame
from PyQt5.QtCore import QRunnable, pyqtSignal, QObject, QStandardPaths
from PyQt5.QtWidgets import QWidget, QVBoxLayout, QHBoxLayout, QLineEdit, QPushButton
from openpyxl.reader.excel import load_workbook
from collections import deque


class WorkerSignals(QObject):  # å®šä¹‰ä¿¡å·ç±»ï¼Œç”¨äºçº¿ç¨‹é—´é€šä¿¡
    finished = pyqtSignal(str)


class DataWorker(QRunnable):  # æ•°æ®å¤„ç†çº¿ç¨‹ï¼ˆAPPID -> æ¸¸æˆIDåˆ—è¡¨ -> åŒºé—´æ±‡æ€»ï¼‰
    def __init__(self, user_id, signals, port, token, code, start_time, end_time):
        super().__init__()
        self.user_id = user_id          # ä¼ å…¥çš„æ˜¯ APPID
        self.signals = signals
        self.port = port
        self.code = code
        self.token = token
        self.start_time = start_time    # ç§’çº§æ—¶é—´æˆ³
        self.end_time = end_time        # ç§’çº§æ—¶é—´æˆ³

    def run(self):
        session = requests.Session()
        headers = {"Cookie": f"token={self.token}"}
        base = f"http://xingfu.boinht.com:{self.port}"

        # ---- å·¥å…·å‡½æ•° ----
        RETRY_STATUS = {429, 500, 502, 503, 504, 403}

        def safe_ts(ts):
            try:
                ts = int(ts)
                if ts > 0:
                    return datetime.fromtimestamp(ts)
            except Exception:
                pass
            return ""

        def make_request(url, data, max_retries=4, timeout=10):
            """
            è½»é‡é‡è¯•ç­–ç•¥ï¼ˆæ›´å¿«æ¢å¤ï¼‰ï¼š
            - 429: ç­‰ ~0.85s å†è¯•ï¼ˆæ¥å£é™æµ 0.8s/æ¬¡ï¼Œç»™ç‚¹ä½™é‡ï¼‰
            - 403: ç­‰ ~1.0s å†è¯•
            - 5xx/ç½‘ç»œå¼‚å¸¸: 0.25s å¿«é€Ÿå¤è¯• + è½»é‡æŒ‡æ•°é€€é¿ï¼ˆ0.4, 0.8, 1.2ï¼‰
            - ç©º result: 0.25s å¿«é€Ÿå¤è¯•ä¸€æ¬¡
            """
            last_exception = None
            empty_retry_used = False

            for attempt in range(1, max_retries + 1):
                try:
                    resp = session.post(url, data=data, headers=headers, timeout=timeout)

                    if not resp.ok:
                        code = resp.status_code
                        if code in RETRY_STATUS:
                            # é’ˆå¯¹é™æµ/æƒé™åšçŸ­ç­‰å¾…ï¼Œå†è¿›å…¥ä¸‹ä¸€è½®
                            if code == 429:
                                time.sleep(0.85 + random.uniform(0.0, 0.05))
                            elif code == 403:
                                time.sleep(1.0 + random.uniform(0.0, 0.1))
                            else:
                                # 5xxï¼šè½»é‡é€€é¿
                                base_delay = 0.4
                                delay = base_delay * (attempt - 1)
                                time.sleep(delay if delay > 0 else 0.25)
                            continue
                        else:
                            # å…¶ä»– 4xx ä¸é‡è¯•
                            return []

                    try:
                        j = resp.json()
                    except Exception as je:
                        last_exception = je
                        # è§£æå¼‚å¸¸åšä¸€æ¬¡å¿«é€Ÿå¤è¯•
                        time.sleep(0.25)
                        continue

                    biz_code = j.get("code", 0)
                    if biz_code != 0:
                        # ä¸šåŠ¡é”™è¯¯ï¼šè½»é‡é€€é¿
                        base_delay = 0.4
                        delay = base_delay * (attempt - 1)
                        time.sleep(delay if delay > 0 else 0.25)
                        continue

                    result = j.get("result", [])
                    if result:
                        return result

                    # ç©ºç»“æœï¼šä»…ä¸€æ¬¡å¿«é€Ÿå¤è¯•
                    if not empty_retry_used:
                        empty_retry_used = True
                        time.sleep(0.25)
                        continue
                    return []

                except Exception as e:
                    last_exception = e
                    # ç½‘ç»œå¼‚å¸¸ï¼šè½»é‡é€€é¿
                    base_delay = 0.4
                    delay = base_delay * (attempt - 1)
                    time.sleep(delay if delay > 0 else 0.25)

            if last_exception:
                print(f"[è¯·æ±‚å¤±è´¥] {url} -> {last_exception}")
            return []

        # ---- æ¯è´¦å·åªåšä¸€æ¬¡å°å»¶è¿Ÿ (1~1.3s) ----
        # time.sleep(random.uniform(1.0, 1.3))

        # ---- ä¸šåŠ¡é€»è¾‘ ----
        # 1) APPID -> ç”¨æˆ·ç”»åƒï¼ˆå«æ¸ é“/IPï¼‰
        url1 = f"{base}/user/pf_list_with_game"
        data1 = {
            "channel_id": "",
            "id": self.user_id,   # ç”¨ APPID æŸ¥è¯¢
            "page_size": 32,
            "page": 1,
            "login_code": self.code,
        }
        data11 = make_request(url1, data1)

        # é¢„ç½®è¾“å‡ºå­—æ®µï¼ˆä¸ºé¿å…å¯¼å‡ºé”™åˆ—ï¼Œå°½é‡å¡«æ»¡ï¼‰
        game_id_for_output = "æ— æ•°æ®"
        æœ‰æ•ˆæŠ•æ³¨ = 0
        æå……å®¢æŸ = 0
        å……å€¼ = 0
        æç° = 0
        æ¸¸æˆæŸç›Š = 0
        app_user_id = self.user_id  # APPID æ”¾åˆ° index 11
        æ³¨å†Œ = æ³¨å†Œipåœ°åŒº = æœ€åç™»å½• = æœ€åç™»å½•ipåœ°åŒº = ""
        æ³¨å†Œæ—¶é—´ = ""
        æœ€åç™»å½•æ—¶é—´ = ""
        æ€»å……å€¼ = 0
        æ€»æç° = 0
        ä½™é¢ = 0
        å•†æˆ· = æ¸ é“ = "æ— "

        if not data11:
            å…¶ä»–ä¿¡æ¯ = f'æ€»å……å€¼ï¼š{æ€»å……å€¼} / æ€»æç°ï¼š{æ€»æç°} / æ‰“èµï¼š"0" / é’»çŸ³ï¼š"0" / ä½™é¢ï¼š{ä½™é¢}'
            æ¸ é“ä¿¡æ¯ = f'{å•†æˆ·} / {æ¸ é“}'
            æ³¨å†ŒIP = f'{æ³¨å†Œ} / {æ³¨å†Œipåœ°åŒº}'
            æœ€åç™»å½•ip = f'{æœ€åç™»å½•} / {æœ€åç™»å½•ipåœ°åŒº}'
            output = (
                f"{game_id_for_output}, {æœ‰æ•ˆæŠ•æ³¨}, {å…¶ä»–ä¿¡æ¯}, {æ³¨å†ŒIP}, {æœ€åç™»å½•ip}, "
                f"{æ³¨å†Œæ—¶é—´}, {æœ€åç™»å½•æ—¶é—´}, {æå……å®¢æŸ}, {å……å€¼}, {æç°}, {æ¸¸æˆæŸç›Š}, {app_user_id}, {æ¸ é“ä¿¡æ¯}"
            )
            print(output)
            self.signals.finished.emit(output)
            return

        # æ­£å¸¸æƒ…å†µï¼šæŒ‰ APPID ä¸€èˆ¬åªè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œå–ç¬¬ä¸€ä¸ªä¸ºå‡†
        aa = data11[0]
        app_user_id = aa.get("id", app_user_id)
        æ³¨å†Œ = aa.get("reg_ip", "") or ""
        æ³¨å†Œipåœ°åŒº = aa.get("reg_ip_adress", "") or ""
        æœ€åç™»å½• = aa.get("last_ip", "") or ""
        æœ€åç™»å½•ipåœ°åŒº = aa.get("pre_ip_adress", "") or ""
        å•†æˆ· = aa.get("channel_id")
        æ¸ é“ = aa.get("open_channel_id")
        æ‰“èµ = aa.get("use_diamond", 0) or 0
        é’»çŸ³ = aa.get("diamond", 0) or 0

        # 2) APPID -> æ¸¸æˆåˆ—è¡¨ï¼ˆå–ç¬¬ä¸€ä¸ªæ¸¸æˆIDä¸ºä¸»ï¼‰
        url2 = f"{base}/user/get_user_game_data_by_app_userid"
        data2 = {"user_id": app_user_id, "login_code": self.code}
        data22 = make_request(url2, data2)

        if data22:
            # èµ„é‡‘ä¿¡æ¯ï¼ˆæŒ‰ä½ åŸé€»è¾‘ï¼šå–â€œæœ€åä¸€ä¸ª bbâ€çš„å€¼ï¼‰
            for bb in data22:
                æ€»å……å€¼ = bb.get("total_recharge", 0) or 0
                æ€»æç° = bb.get("total_cash", 0) or 0
                ä½™é¢ = bb.get("money", 0) or 0
                æ³¨å†Œæ—¶é—´ = safe_ts(bb.get("create_time", 0))
                æœ€åç™»å½•æ—¶é—´ = safe_ts(bb.get("last_login", 0))

            æ¸¸æˆidåˆ—è¡¨ = [bb.get("id") for bb in data22 if bb.get("id")]
            if æ¸¸æˆidåˆ—è¡¨:
                game_id_for_output = æ¸¸æˆidåˆ—è¡¨[0]

                # 3) é€‰å®šçš„æ¸¸æˆID -> åŒºé—´æ±‡æ€»
                url3 = f"{base}/pp_user/recent_overview_by_userid"
                data3 = {
                    "user_id": game_id_for_output,
                    "start_time": self.start_time,
                    "end_time": self.end_time,
                    "login_code": self.code,
                }
                data33 = make_request(url3, data3)
                if data33:
                    cc = data33[0]
                    æœ‰æ•ˆæŠ•æ³¨ = cc.get("vaild_bet") or 0
                    æ¸¸æˆæŸç›Š = cc.get("delta_bet_win") or 0
                    å……å€¼ = cc.get("recharge", 0) or 0
                    æå……å®¢æŸ = cc.get("delta_recharge_cash", 0) or 0
                    æç° = cc.get("cash") or 0

        å…¶ä»–ä¿¡æ¯ = f'æ€»å……å€¼ï¼š{æ€»å……å€¼} / æ€»æç°ï¼š{æ€»æç°} / æ‰“èµï¼š"{æ‰“èµ}" / é’»çŸ³ï¼š"{é’»çŸ³}" / ä½™é¢ï¼š{ä½™é¢}'
        æ¸ é“ä¿¡æ¯ = f'{å•†æˆ·} / {æ¸ é“}'
        æ³¨å†ŒIP = f'{æ³¨å†Œ} / {æ³¨å†Œipåœ°åŒº}'
        æœ€åç™»å½•ip = f'{æœ€åç™»å½•} / {æœ€åç™»å½•ipåœ°åŒº}'

        # â€”â€” æœ€ç»ˆè¾“å‡ºï¼ˆåˆ—é¡ºåºä¸ export_data å®Œå…¨åŒ¹é…ï¼‰â€”â€”
        output = (
            f"{game_id_for_output}, {æœ‰æ•ˆæŠ•æ³¨}, {å…¶ä»–ä¿¡æ¯}, {æ³¨å†ŒIP}, {æœ€åç™»å½•ip}, "
            f"{æ³¨å†Œæ—¶é—´}, {æœ€åç™»å½•æ—¶é—´}, {æå……å®¢æŸ}, {å……å€¼}, {æç°}, {æ¸¸æˆæŸç›Š}, {app_user_id}, {æ¸ é“ä¿¡æ¯}"
        )

        print(output)
        self.signals.finished.emit(output)


# ===== æ–°å¢ï¼šCookieWorkerï¼ˆä¸€ä¸ª Cookie ä¸€ä¸ªçº¿ç¨‹ï¼Œå®Œæˆ+1s é™é€Ÿï¼‰=====
class CookieWorker(QThread):
    def __init__(self, owner, group, token, queue_deque, port, code, start_ts, end_ts):
        super().__init__()
        self.owner = owner
        self.group = group
        self.token = token
        self.queue = queue_deque  # é¢„åˆ†ç‰‡åçš„ç‹¬ç«‹é˜Ÿåˆ—ï¼ˆæ— é”ï¼‰
        self.port = port
        self.code = code
        self.start_ts = start_ts
        self.end_ts = end_ts
        self._stop = False

    def stop(self):
        self._stop = True

    def run(self):
        last_finish = 0.0
        while not self._stop:
            # å…¨å±€æš‚åœï¼šç²—ç²’åº¦ä¼‘çœ ç­‰å¾…æ¢å¤
            if getattr(self.owner, "paused", False):
                time.sleep(0.15)
                continue

            if not self.queue:
                break  # æœ¬çº¿ç¨‹ä»»åŠ¡è€—å°½

            user_id = self.queue.popleft()

            # ä¸ä¸»çº¿ç¨‹çš„å›è°ƒä¿¡å·
            signals = WorkerSignals()
            signals.finished.connect(self.owner.task_finished, Qt.QueuedConnection)

            # æ‰§è¡Œå•ä¸ªè´¦å·ä»»åŠ¡ï¼Œå¼‚å¸¸å…œåº•
            start_one = time.time()
            try:
                worker = DataWorker(user_id, signals, self.port, self.token, self.code,
                                    self.start_ts, self.end_ts)
                worker.run()  # DataWorker å†…éƒ¨åº”åœ¨å®Œæˆæ—¶ signals.finished.emit(result)
            except Exception as e:
                # å…œåº•æŠŠé”™è¯¯ä¹Ÿå›ä¼ ï¼Œé¿å…çº¿ç¨‹ç›´æ¥å´©æ‰
                try:
                    err = {"user_id": user_id, "ok": False, "error": str(e)}
                    signals.finished.emit(err)
                except Exception:
                    pass
            finally:
                last_finish = time.time()

            # å®Œæˆ + 1s é™é€Ÿï¼ˆå«è¯·æ±‚è€—æ—¶ï¼‰ï¼Œæ›´ç¨³å¦¥
            elapsed = last_finish - start_one
            if elapsed < 1.0:
                # è‹¥å…¨å±€å·²æš‚åœ/åœæ­¢ï¼Œå¿«é€Ÿå“åº”ï¼›å¦åˆ™è¡¥è¶³åˆ° 1 ç§’
                remain = 1.0 - elapsed
                slept = 0.0
                step = 0.05
                while slept < remain and not self._stop and not getattr(self.owner, "paused", False):
                    time.sleep(min(step, remain - slept))
                    slept += step

        # çº¿ç¨‹è‡ªç„¶ç»“æŸï¼Œäº¤ç”±ä¸»çº¿ç¨‹ç»Ÿè®¡ done
        # ä¸éœ€è¦æ˜¾å¼å‘ finished ç»“æœï¼Œè¿™é‡Œçš„çº¿ç¨‹ finished ç”¨ QThread.finished ä¿¡å·


class UserWindow(QWidget):  # ä¸»çª—å£ç±»
    def __init__(self):
        super().__init__()
        self.setWindowTitle("æ•°æ®ç²¾çµ")
        self.resize(1200, 800)  # åˆå§‹å¤§å°

        # ğŸŒ è”ç½‘éªŒè¯ + æ—¶é—´éªŒè¯
        self.check_network_validation()

        # åŠ è½½ base64 å›¾æ ‡ï¼ˆç¡®ä¿å­—ç¬¦ä¸²å®Œæ•´ï¼‰
        icon_base64 = "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//8iV///Ilf//yJX//8iV///Ilf//yJW//IiV/+HGFX/FQAAAAAAAAAAAAAAACFV/ychV//OIlf/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/PSFW/88iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV//2Ilf/ryJX/5AiV/+1Ilf/+iJX//8iV//aAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJEn/ByFW/5IiVv/+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/6UAAAAAAAAAAAAAAAAAAAAAAAAAACBV/xghVv/JIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/TAAAAAAAAAAAAAAAAAAAAAAhWv8fIVf/3SJX//8iV///Ilf//yJX/+giVv+9IVf/oSJX/5YiV/+cIlb/tCJX/98iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/84AAP8BAAAAAAAAAAAAAAAAIVn/FyJX/9wiV///Ilb/ySJV/28jVf8kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFS/x8hV/91Ilf/4CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8hV//8IFf/OAAAAAAAAAAAAAAAACpV/wYiV//FIlf/rSJY/zQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYgVv+OIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/4gAAAAAAAAAAAAAAAAAAAAAIVf/VSBT/zcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhWf8XIlf/xSJX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AAAAAAAAIlb/dyJX//8hVv/PG1H/EwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIGD/CABV/wMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABxV/wkhV//lIVf/wh5a/xEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/eiJX/5wkSf8HAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFZ/xciVv9TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AUBA/wQqVf8GJEn/BzNm/wUAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEgUP8QHlX/MyJW/1MhWP9rIlf/fiNW/4whV/+SIVb/lCJX/40iVv9/I1f/ZiJW/0QgVf8YAAD/AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFT/y4hWf8XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaTf8KIlf/TCFY/6AjV//VIVf/5SJX//AiV//4Ilf//iJX//8iV///Ilf//yJX//8iVv/+Ilf/9yJX/+siV//YIlf/liNX/ywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFv/KiJX/9AjV/9JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcVf8JHVf/IyFW/3whV//fIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW//ghVv+gIVf/Lxdd/wsAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYkWP9AIVj/3SJX//UhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACNU/zoiVv+UIlf/5CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/6iJX/54gWP9XIlP/JSBg/xAcVf8bI1X/QiFX/4oiV//iIlf//yJX//YhVv9lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbXv8TIlf/kCJX/+giV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//4iV//xIlf/4SJX/9ohV//dIlf/6iJX//wiV///Ilf//yJX//EhV/9VAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQED/BCBY/zciV//IIlf//iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yNX/+UkV/8yAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgUP8QIVb/cyJX/+ciV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/8MaTf8KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdi/w0iV/+VIlf/9iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/2EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiNW/6EiV///Ilf//yJX//8iV///Ilf//yJX//oiV//vIlf/5yJX/+EhV//dIlf/3CNX/90iV//hIlf/6CJX//EiV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/0kBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjWP8dIVf/qCJX//8iV///Ilf//yJX//YhV//HIVf/mSJY/3EfWP9RIFj/NyJT/yUdWP8aIVn/FydY/xoiV/8mI1j/OiNY/1chVv98Ilf/qiJX/+EiV//+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iVv/vIlf/TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdO/w0hWP+aIlf/+yJX//8iV//nIVb/iyRX/zIgVf8YHFX/CQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgP8CJFv/DiJa/yUhVv9zIlf/6CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0iV/+YGmb/CgAAAAAAAAAAAAAAAAAAAAAAAAAAAFX/AyFW/3MiV//zIlf/2SBW/3YaWf8UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEcVf8SIlf/gSJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/9giU/8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFf/WCJW/8MgV/9vHVj/GgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJb/y0iV/+tIlf/+SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/74AQP8EAAAAAAAAAAAAAAAAAAAAAAAAAAAgWP8gIlb/WR1Y/xoAVf8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFT/QCFX/94iV//9Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/+AiWv8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQiVv9TIlj/6yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/+0iVv9KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJX/2EiV//iIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//YhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BI1f/bCJX//EiV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//shVv90AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQhWP9jIlf/8SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0hV/97AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFX/1UiVv/PIFn/PwBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiJX/58hVf8nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIlP/JSJV/w8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="  # æ›¿æ¢æˆä½ çš„ base64
        icon_data = QByteArray.fromBase64(icon_base64.encode())

        # æ›´å¯é çš„å›¾æ ‡åŠ è½½æ–¹å¼
        pixmap = QPixmap()
        if not pixmap.loadFromData(icon_data, "ICO"):  # æ˜¾å¼æŒ‡å®šæ ¼å¼
            print("âŒ å›¾æ ‡åŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥ base64 æ•°æ®æˆ–æ–‡ä»¶æ ¼å¼")
        else:
            self.setWindowIcon(QIcon(pixmap))  # è®¾ç½®çª—å£å’Œä»»åŠ¡æ å›¾æ ‡

        self.groups = self.load_group_names_from_config()
        self.token_inputs = {}

        self.completed_tasks = []  # åˆå§‹åŒ–å·²å®Œæˆä»»åŠ¡åˆ—è¡¨

        # è®¾ç½®ä¸»çª—å£æ ·å¼
        self.setStyleSheet("""
            QPushButton {
                background-color: white;            /* ç™½è‰²èƒŒæ™¯ */
                color: #3498db;                     /* è“è‰²æ–‡å­— */
                border: 1px solid #3498db;          /* è“è‰²è¾¹æ¡† */
                border-radius: 8px;                 /* åœ†è§’åŠå¾„8px */
                padding: 10px 16px;                 /* å†…è¾¹è· */
                font-size: 16px;                    /* å­—ä½“å¤§å° */
                font-weight: bold;                 /* å­—ä½“åŠ ç²— */
                letter-spacing: 0.5px;              /* å­—ç¬¦é—´è· */
            }

            QPushButton:hover {
                background-color: #ecf5fb;          /* é¼ æ ‡æ‚¬åœæ—¶æµ…è“èƒŒæ™¯ï¼ˆè§†è§‰åé¦ˆï¼‰ */
                color: #2980b9;                     /* æ‚¬åœæ—¶æ–‡å­—é¢œè‰²ç¨å¾®åŠ æ·± */
                border: 1px solid #2980b9;          /* è¾¹æ¡†é¢œè‰²ä¹Ÿç¨å¾®åŠ æ·± */
            }

            QPushButton:pressed {
                background-color: #d6eaf8;          /* æŒ‰ä¸‹æ—¶æ›´æ·±ä¸€ç‚¹çš„æµ…è“èƒŒæ™¯ */
                padding-left: 14px;                 /* æ¨¡æ‹ŸæŒ‰å‹æ„Ÿ */
                padding-top: 12px;
            }

            QPushButton:disabled {
                background-color: #f0f0f0;          /* ç¦ç”¨æ—¶èƒŒæ™¯ç°è‰² */
                color: #bdc3c7;                     /* ç¦ç”¨æ—¶å­—ä½“æµ…ç° */
                border: 1px solid #ccc;             /* è¾¹æ¡†å˜æµ…ç° */
            }

            QLineEdit, QComboBox, QDateTimeEdit {
                padding: 6px;                      /* è¾“å…¥æ§ä»¶å†…è¾¹è·ï¼ˆ6pxï¼‰ */
                border: 1px solid #ccc;            /* è¾¹æ¡†é¢œè‰²ä¸ºæµ…ç°è‰² */
                border-radius: 5px;                /* åœ†è§’ï¼ˆ5pxï¼‰ */
                font-size: 20px;                   /* å­—ä½“å¤§å°ï¼ˆ20pxï¼‰ */
            }

            QGroupBox {
                border: 1px solid #aaa;  /* ç»„æ¡†è¾¹æ¡†é¢œè‰²å’Œå®½åº¦ */
                border-radius: 8px;  /* ç»„æ¡†åœ†è§’ */
                margin-top: 6px;  /* ç»„æ¡†é¡¶éƒ¨å¤–è¾¹è· */
            }

            QGroupBox::title {
                subcontrol-origin: margin;  /* ç»„æ¡†æ ‡é¢˜åŸºäºè¾¹è·å®šä½ */
                subcontrol-position: top center;  /* ç»„æ¡†æ ‡é¢˜å±…ä¸­ */
                padding: 0 6px;  /* ç»„æ¡†æ ‡é¢˜å†…è¾¹è· */
                font-size: 15px;  /* ç»„æ¡†æ ‡é¢˜å­—ä½“å¤§å° */
                font-weight: bold;  /* ç»„æ¡†æ ‡é¢˜åŠ ç²— */
            }
        """)

        main_layout = QVBoxLayout(self)  # è®¾ç½®ä¸»å¸ƒå±€ä¸ºå‚ç›´å¸ƒå±€

        # å†…å®¹åŒºåŸŸï¼šå¯¼èˆªæ  + é¡µé¢
        content_layout = QHBoxLayout()  # æ°´å¹³å¸ƒå±€å®¹çº³å¯¼èˆªæ å’Œé¡µé¢

        # å·¦ä¾§å¯¼èˆªæ 
        self.nav_list = QListWidget()
        self.nav_list.setFixedWidth(200)  # è®¾ç½®å›ºå®šå®½åº¦
        self.nav_list.setFont(QFont("Microsoft YaHei", 11))  # è®¾ç½®å­—ä½“å’Œå¤§å°

        # è®¾ç½®å¯¼èˆªæ æ ·å¼
        self.nav_list.setStyleSheet("""
                    QListWidget {
                        background-color: #2c3e50;  /* åˆ—è¡¨æ§ä»¶èƒŒæ™¯é¢œè‰²ï¼ˆæ·±è“è‰²ï¼‰ */
                        color: #ecf0f1;            /* åˆ—è¡¨é»˜è®¤æ–‡å­—é¢œè‰²ï¼ˆæµ…ç°è‰²ï¼‰ */
                        border: none;              /* æ— è¾¹æ¡† */
                        padding-top: 15px;        /* é¡¶éƒ¨å†…è¾¹è·ï¼ˆ15pxï¼‰ */
                        outline: none;            /* ç§»é™¤ç„¦ç‚¹æ—¶çš„è™šçº¿è¾¹æ¡† */
                    }
                    QListWidget::item {
                        padding: 12px 20px;       /* åˆ—è¡¨é¡¹å†…è¾¹è·ï¼ˆä¸Šä¸‹12pxï¼Œå·¦å³20pxï¼‰ */
                        margin: 6px 10px;         /* åˆ—è¡¨é¡¹å¤–è¾¹è·ï¼ˆä¸Šä¸‹6pxï¼Œå·¦å³10pxï¼‰ */
                        font-weight: normal;      /* æ­£å¸¸å­—ä½“ç²—ç»† */
                        border-radius: 6px;       /* åˆ—è¡¨é¡¹åœ†è§’åŠå¾„ï¼ˆ6pxï¼‰ */
                    }
                    QListWidget::item:hover {
                        background-color: #3d566e;  /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯é¢œè‰²ï¼ˆç¨äº®çš„è“è‰²ï¼‰ */
                        font-weight: bold;         /* æ‚¬åœæ—¶å­—ä½“åŠ ç²— */
                        color: #ffffff;            /* æ‚¬åœæ—¶æ–‡å­—é¢œè‰²ï¼ˆçº¯ç™½ï¼‰ */
                    }
                    QListWidget::item:selected {
                        background-color: #1abc9c;  /* é€‰ä¸­é¡¹èƒŒæ™¯é¢œè‰²ï¼ˆè“ç»¿è‰²ï¼‰ */
                        color: #ffffff;            /* é€‰ä¸­é¡¹æ–‡å­—é¢œè‰²ï¼ˆçº¯ç™½ï¼‰ */
                        font-weight: bold;         /* é€‰ä¸­é¡¹å­—ä½“åŠ ç²— */
                    }
                """)

        item1 = QListWidgetItem("ğŸ“Š æ•°æ®é‡‡é›†")
        item2 = QListWidgetItem("âš™ï¸ å‚æ•°é…ç½®")
        item3 = QListWidgetItem("ğŸ“˜ å…³äº")

        item1.setSizeHint(QSize(item1.sizeHint().width(), 40))
        item2.setSizeHint(QSize(item2.sizeHint().width(), 40))
        item3.setSizeHint(QSize(item3.sizeHint().width(), 40))

        self.nav_list.addItem(item1)
        self.nav_list.addItem(item2)
        self.nav_list.addItem(item3)

        self.nav_list.setCurrentRow(0)
        self.nav_list.currentRowChanged.connect(self.switch_page)

        # å³ä¾§é¡µé¢æ ˆ
        self.pages = QStackedWidget()
        self.data_tab = QWidget()
        self.config_tab = QWidget()
        self.about_tab = QWidget()
        self.pages.addWidget(self.data_tab)
        self.pages.addWidget(self.config_tab)
        self.pages.addWidget(self.about_tab)

        content_layout.addWidget(self.nav_list)
        content_layout.addWidget(self.pages)
        main_layout.addLayout(content_layout)

        # çŠ¶æ€æ ä¸è¿›åº¦æ¡
        self.status_label = QLabel("çŠ¶æ€ï¼šç­‰å¾…ä¸­")
        self.progress_bar = QProgressBar()
        self.progress_bar.setVisible(False)
        main_layout.addWidget(self.status_label)
        main_layout.addWidget(self.progress_bar)

        # é¡µé¢è®¾ç½®
        self.setup_data_tab()
        self.setup_config_tab()
        self.setup_about_tab()

        self.load_config()
        self.set_default_dates_for(self.start_time_input, self.end_time_input)

    def check_network_validation(self):
        try:
            program_id = "appid_dashujuhebing"  # æ¯ä¸ªç¨‹åºç”¨è‡ªå·±çš„åå­—ï¼ˆå¿…é¡»å’ŒJSONæ–‡ä»¶é‡Œçš„ key å¯¹åº”ï¼‰
            response = requests.get("http://8.210.92.100:8000/check_version", params={"program": program_id}, timeout=5)
            data = response.json()

            status = data.get("status")

            if status != "active":
                QMessageBox.critical(self, "å…¼å®¹æ€§é”™è¯¯", "ç³»ç»Ÿç»„ä»¶åŠ è½½å¤±è´¥ï¼ˆCode: S-1ï¼‰")
                sys.exit(0)

        except Exception:
            QMessageBox.critical(self, "å…¼å®¹æ€§é”™è¯¯", "ç»„ä»¶è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼ˆCode: S-2ï¼‰")
            sys.exit(0)

    def switch_page(self, index):
        self.pages.setCurrentIndex(index)

    def setup_data_tab(self):  # æ•°æ®è·å–é¡µé¢
        layout = QVBoxLayout()

        # æ–‡ä»¶é€‰æ‹©åŒºåŸŸï¼ˆå·²ç§»é™¤çº¿ç¨‹æ•°å’Œå°ç»„é€‰æ‹©ï¼‰
        file_group = QGroupBox("æ‚¨å¥½ï¼Œæ¬¢è¿ä½¿ç”¨æ•°æ®ç²¾çµï¼")
        file_layout = QVBoxLayout()

        self.file_button = QPushButton("ğŸ“ é€‰æ‹©æ–‡ä»¶")
        self.file_button.clicked.connect(self.select_file)
        file_layout.addWidget(self.file_button)

        file_group.setLayout(file_layout)
        layout.addWidget(file_group)

        # æ—¥æœŸèŒƒå›´
        date_group = QGroupBox("æ—¥æœŸèŒƒå›´é€‰æ‹©")
        date_layout = QVBoxLayout()

        def disable_mouse_click_adjust(edit: QDateTimeEdit):
            def blocked_mousePressEvent(event):
                if event.button() == Qt.LeftButton:
                    event.ignore()
                else:
                    QDateTimeEdit.mousePressEvent(edit, event)

            edit.mousePressEvent = blocked_mousePressEvent

        # å¼€å§‹æ—¶é—´
        self.start_time_input = QDateTimeEdit()
        self.start_time_input.setCalendarPopup(True)
        self.start_time_input.setDisplayFormat("yyyy-MM-dd HH:mm:ss")
        self.start_time_input.wheelEvent = lambda event: event.ignore()
        disable_mouse_click_adjust(self.start_time_input)

        # ç»“æŸæ—¶é—´
        self.end_time_input = QDateTimeEdit()
        self.end_time_input.setCalendarPopup(True)
        self.end_time_input.setDisplayFormat("yyyy-MM-dd HH:mm:ss")
        self.end_time_input.wheelEvent = lambda event: event.ignore()
        disable_mouse_click_adjust(self.end_time_input)

        date_layout.addWidget(QLabel("å¼€å§‹æ—¶é—´ï¼š"))
        date_layout.addWidget(self.start_time_input)
        date_layout.addWidget(QLabel("ç»“æŸæ—¶é—´ï¼š"))
        date_layout.addWidget(self.end_time_input)

        nav_layout = QHBoxLayout()

        self.prev_day_btn = QPushButton("âª ä¸Šä¸€æ—¥")
        self.prev_day_btn.clicked.connect(self.on_prev_day_clicked)
        nav_layout.addWidget(self.prev_day_btn)

        self.today_btn = QPushButton("âºï¸ å½“æ—¥")
        self.today_btn.clicked.connect(self.on_today_clicked)
        nav_layout.addWidget(self.today_btn)

        self.next_day_btn = QPushButton("ä¸‹ä¸€æ—¥ â©")
        self.next_day_btn.clicked.connect(self.on_next_day_clicked)
        nav_layout.addWidget(self.next_day_btn)

        date_layout.addLayout(nav_layout)
        date_group.setLayout(date_layout)
        layout.addWidget(date_group)

        # æ“ä½œæŒ‰é’®æ°´å¹³å¸ƒå±€
        button_layout = QHBoxLayout()

        self.get_button = QPushButton("ğŸš€ å¼€å§‹é‡‡é›†")
        self.get_button.clicked.connect(self.start_processing)
        button_layout.addWidget(self.get_button)

        self.export_button = QPushButton("ğŸ“¤ å¯¼å‡ºæ•°æ®")
        self.export_button.clicked.connect(self.export_data)
        button_layout.addWidget(self.export_button)

        layout.addSpacing(16)
        layout.addLayout(button_layout)

        self.data_tab.setLayout(layout)

        # åˆå§‹æ ·å¼è®¾ç½®
        self.highlight_selected_check_bu(self.today_btn)

    def highlight_selected_check_bu(self, selected_button):
        buttons = [
            self.prev_day_btn,
            self.today_btn,
            self.next_day_btn,
        ]
        for btn in buttons:
            if btn == selected_button:
                btn.setStyleSheet("""
                            QPushButton {
                                background-color: #1DA1F2;
                                color: white;
                                border-radius: 6px;
                                padding: 8px 14px;
                                font-weight: bold;
                            }
                            QPushButton:hover {
                                background-color: #0d8ddf;
                            }
                        """)
            else:
                btn.setStyleSheet("""
                            QPushButton {
                                background-color: white;
                                color: #3498db;
                                border: 1px solid #3498db;
                                border-radius: 6px;
                                padding: 8px 14px;
                                font-weight: bold;
                            }
                            QPushButton:hover {
                                background-color: #ecf5fb;
                                color: #2980b9;
                                border: 1px solid #2980b9;
                            }
                        """)

    def on_today_clicked(self):  # å½“æ—¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        self.set_default_dates_for(self.start_time_input, self.end_time_input)  # è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
        self.highlight_selected_check_bu(self.today_btn)  # é«˜äº®é€‰ä¸­æŒ‰é’®

    def on_prev_day_clicked(self):  # ä¸Šä¸€æ—¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        self.move_to_previous_day_for(self.start_time_input, self.end_time_input)  # ç§»åŠ¨åˆ°å‰ä¸€å¤©
        self.highlight_selected_check_bu(self.prev_day_btn)  # é«˜äº®é€‰ä¸­æŒ‰é’®

    def on_next_day_clicked(self):  # ä¸‹ä¸€æ—¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        self.move_to_next_day_for(self.start_time_input, self.end_time_input)  # ç§»åŠ¨åˆ°åä¸€å¤©
        self.highlight_selected_check_bu(self.next_day_btn)  # é«˜äº®é€‰ä¸­æŒ‰é’®

    def setup_config_tab(self):  # é…ç½®é¡µé¢
        layout = QVBoxLayout()

        config_group = QGroupBox("åˆ†ç»„ Cookie å‚æ•°")
        grid = QGridLayout()

        max_rows_per_column = 8  # æ¯åˆ—æœ€å¤š8è¡Œ
        for i, group in enumerate(self.groups):
            row = i % max_rows_per_column
            col = (i // max_rows_per_column) * 2  # æ¯ç»„å 2åˆ—ï¼šlabel + input

            label = QLabel(f"{group} ï¼š")
            line_edit = QLineEdit()
            line_edit.setPlaceholderText(f"è¯·è¾“å…¥Cookieï¼ˆå¤šä¸ªç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼‰")
            line_edit.setToolTip("æ”¯æŒå¤šä¸ª Cookieï¼Œä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šck1,ck2,ck3")
            self.token_inputs[group] = line_edit

            grid.addWidget(label, row, col)
            grid.addWidget(line_edit, row, col + 1)

        config_group.setLayout(grid)
        layout.addWidget(config_group)

        # ç«¯å£é…ç½®
        port_group = QGroupBox("åŸºç¡€å‚æ•° (é€šç”¨)")
        port_layout = QVBoxLayout()

        port_row = QHBoxLayout()
        port_label = QLabel("ğŸŒ ç«¯å£å·ï¼š")
        self.port_input = QLineEdit()
        self.port_input.setPlaceholderText("è¯·è¾“å…¥ç«¯å£å·ï¼Œä¾‹å¦‚ï¼š8080")
        port_row.addWidget(port_label)
        port_row.addWidget(self.port_input)
        port_layout.addLayout(port_row)

        code_row = QHBoxLayout()
        code_label = QLabel("ğŸ”¢ ç™»å½•ç ï¼š")
        self.code_input = QLineEdit()
        self.code_input.setPlaceholderText("è¯·è¾“å…¥å°æ˜è®¡ç®—å™¨ç™»é™†ç ")
        code_row.addWidget(code_label)
        code_row.addWidget(self.code_input)
        port_layout.addLayout(code_row)

        port_group.setLayout(port_layout)
        layout.addWidget(port_group)

        self.save_button = QPushButton("ğŸ’¾ ä¿å­˜é…ç½®")
        self.save_button.clicked.connect(self.manual_save)
        layout.addSpacing(16)
        layout.addWidget(self.save_button)

        self.config_tab.setLayout(layout)

    def setup_about_tab(self):  # å…³äºæˆ‘ä»¬é¡µé¢ï¼ˆç™½è‰²å£°æ˜æ¡†å¡«å……åˆ°åº•ï¼‰
        layout = QVBoxLayout()
        layout.setContentsMargins(12, 12, 16, 16)
        layout.setSpacing(0)

        content = QWidget()
        col = QVBoxLayout(content)
        col.setContentsMargins(0, 0, 0, 0)
        col.setSpacing(0)

        version = getattr(self, "app_version", "v1.0.0")
        update_date = getattr(self, "app_update_date", "2025-08-24")

        # æ ‡é¢˜
        title = QLabel("å…³äºæ•°æ®ç²¾çµï¼ˆAPPIDç‰ˆï¼‰")
        title.setStyleSheet("font-size:25px; font-weight:700; color:#1f2937;")
        col.addWidget(title, 0, Qt.AlignLeft)
        col.addSpacing(15)

        # ç‰ˆæœ¬è¡Œï¼ˆå­—å·åŠ å¤§ï¼‰
        ver_row = QHBoxLayout()
        ver_row.setSpacing(8)

        ver_label = QLabel("ç‰ˆæœ¬ï¼š")
        ver_label.setStyleSheet("font-size:16px;")  # â† åŠ å¤§

        ver_value = QLabel(version)
        ver_value.setStyleSheet("font-size:16px; color:#0f766e; font-weight:600;")  # â† åŠ å¤§

        date_label = QLabel(f"  æ›´æ–°æ—¥æœŸï¼š{update_date}")
        date_label.setStyleSheet("font-size:16px; color:#64748b;")  # â† åŠ å¤§

        ver_row.addWidget(ver_label, 0, Qt.AlignLeft)
        ver_row.addWidget(ver_value, 0, Qt.AlignLeft)
        ver_row.addWidget(date_label, 0, Qt.AlignLeft)
        ver_row.addStretch(1)
        col.addLayout(ver_row)
        col.addSpacing(35)

        # â€œå£°æ˜ï¼šâ€ æ ‡é¢˜
        decl_title = QLabel("å£°æ˜ï¼š")
        decl_title.setStyleSheet("font-size:14px; font-weight:700; color:#111827;")
        col.addWidget(decl_title, 0, Qt.AlignLeft)
        col.addSpacing(12)

        # ç™½è‰²æ¡†
        box = QFrame()
        box.setStyleSheet("""
            QFrame {
                background: #ffffff;
                border-radius: 8px;
            }
        """)
        box.setSizePolicy(QSizePolicy.Expanding, QSizePolicy.Expanding)
        box_layout = QVBoxLayout(box)
        box_layout.setContentsMargins(14, 12, 14, 12)
        box_layout.setSpacing(6)

        # å£°æ˜æ­£æ–‡ï¼ˆæœ€åä¸€å¥åŠ ç²—ï¼‰
        body = QLabel(
            "<div style='color:#374151; font-size:15px; line-height:1.9;'>"
            "ã€Šæ•°æ®ç²¾çµã€‹ï¼ˆåŸåã€ŠAPPIDè·å–å¤§æ•°æ®ã€‹),æœ¬è½¯ä»¶ä»…ä¾›å…·å¤‡åå°è®¿é—®æƒé™ä¸”å·²è·æˆæƒçš„ç”¨æˆ·åœ¨åˆè§„å‰æä¸‹ä½¿ç”¨,ä¸»è¦ç”¨äºé‡‡é›†å¹³å°ç›¸å…³è´¦å·å¤§æ•°æ®ã€‚"
            "ä½¿ç”¨è€…åº”ç¡®è®¤/ä¿è¯æ•°æ®ä¸è´¦å·æ¥æºåˆè§„ã€æˆæƒå……åˆ†ï¼Œå¹¶å¯¹è‡ªèº«æ“ä½œåŠç»“æœæ‰¿æ‹…å…¨éƒ¨è´£ä»»ã€‚<br/><br/>"
            "å› æˆæƒä¸è¶³æˆ–è¿è§„ä½¿ç”¨å¯¼è‡´çš„ä»»ä½•æŸå¤±ã€å¤„ç½šç­‰ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚æœ¬è½¯ä»¶æŒ‰â€œç°çŠ¶â€æä¾›ï¼Œä¸ä½œä»»ä½•æ˜ç¤ºæˆ–é»˜ç¤ºæ‹…ä¿ï¼›"
            "ä½œè€…å¯¹å› ä½¿ç”¨æˆ–æ— æ³•ä½¿ç”¨æœ¬è½¯ä»¶é€ æˆçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±ä¸æ‰¿æ‹…è´£ä»»ã€‚æœ¬è½¯ä»¶ä¸ç›¸å…³å¹³å°/å•†æˆ·/æ”¯ä»˜æœºæ„æ— éš¶å±æˆ–åˆä½œå…³ç³»ã€‚<br/><br/>"
            "<b>ç»§ç»­ä½¿ç”¨å³è¡¨ç¤ºæ‚¨å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„æœ¬å£°æ˜ã€‚</b>"
            "</div>"
        )
        body.setWordWrap(True)
        body.setTextFormat(Qt.RichText)
        body.setContentsMargins(0, 0, 0, 0)
        body.setMargin(0)
        box_layout.addWidget(body, 0, Qt.AlignTop)
        box_layout.addStretch(1)

        col.addWidget(box, 1)

        layout.addWidget(content, 1)
        self.about_tab.setLayout(layout)

    def set_default_dates_for(self, start_input, end_input):  # è®¾ç½®é»˜è®¤ä»Šå¤©å’Œæ˜å¤©
        current_date = datetime.now().date()
        tomorrow = current_date + timedelta(days=1)
        start_input.setDateTime(QDateTime(current_date.year, current_date.month, current_date.day, 0, 0))
        end_input.setDateTime(QDateTime(tomorrow.year, tomorrow.month, tomorrow.day, 0, 0))

    def move_to_previous_day_for(self, start_input, end_input):  # ç§»åŠ¨åˆ°å‰ä¸€å¤©
        date = start_input.dateTime().addDays(-1)
        start_input.setDateTime(date)
        end_input.setDateTime(date.addDays(1))

    def move_to_next_day_for(self, start_input, end_input):  # ç§»åŠ¨åˆ°åä¸€å¤©
        date = start_input.dateTime().addDays(1)
        start_input.setDateTime(date)
        end_input.setDateTime(date.addDays(1))

    def select_file(self):  # é€‰æ‹©ç”¨æˆ·IDæ–‡ä»¶ï¼ˆExcelï¼‰
        desktop_path = QStandardPaths.writableLocation(QStandardPaths.DesktopLocation)
        file_name, _ = QFileDialog.getOpenFileName(
            self, "é€‰æ‹©ç”¨æˆ·ID Excelæ–‡ä»¶", desktop_path,
            "Excel Files (*.xlsx);;All Files (*)"
        )

        if file_name:
            self.user_ids = []  # æ¸…ç©ºæ—§æ•°æ®
            error_rows = []

            try:
                wb = load_workbook(filename=file_name, data_only=True)
                ws = wb.active

                headers = {cell.value: idx for idx, cell in enumerate(next(ws.iter_rows(min_row=1, max_row=1)))}
                if 'GameId' not in headers or 'Source' not in headers:
                    QMessageBox.warning(self, "é”™è¯¯", "Excelæ–‡ä»¶ç¼ºå°‘å¿…è¦çš„è¡¨å¤´ï¼š'GameId' æˆ– 'Source'")
                    return

                for row_idx, row in enumerate(ws.iter_rows(min_row=2), start=2):
                    user_id = str(row[headers['GameId']].value).strip()
                    group = str(row[headers['Source']].value).strip()

                    if group and user_id.isdigit():
                        self.user_ids.append({"group": group, "user_id": user_id})
                    else:
                        error_rows.append(row_idx)

                if error_rows:
                    msg = f"éƒ¨åˆ†è¡Œæ ¼å¼æœ‰è¯¯ï¼ˆéæ•°å­—IDæˆ–å°ç»„ä¸ºç©ºï¼‰ï¼Œé”™è¯¯è¡Œå·ï¼š{', '.join(map(str, error_rows))}"
                    QMessageBox.warning(self, "é”™è¯¯", msg)
                else:
                    QMessageBox.information(self, "å¯¼å…¥æˆåŠŸ", f"æˆåŠŸå¯¼å…¥ {len(self.user_ids)} ä¸ªç”¨æˆ·è´¦å·ï¼")
                    self.get_button.setEnabled(True)

            except Exception as e:
                QMessageBox.warning(self, "é”™è¯¯", f"è¯»å–Excelå‡ºé”™ï¼š{str(e)}")

    # ===== æ›¿æ¢ï¼šstart_processingï¼ˆå¤š Cookie = å¤šçº¿ç¨‹ï¼›é¢„åˆ†ç‰‡è½®è¯¢åˆ†é…ï¼‰=====
    def start_processing(self):
        if not hasattr(self, 'user_ids') or not self.user_ids:
            QMessageBox.warning(self, "æç¤º", "è¯·å…ˆé€‰æ‹©åŒ…å«ç”¨æˆ·IDçš„æ–‡ä»¶ï¼")
            return

        self.completed_tasks = []
        port = self.port_input.text().strip()
        code = self.code_input.text().strip()

        missing_fields = []
        if not port:
            missing_fields.append("ç«¯å£ï¼ˆportï¼‰")
        if not code:
            missing_fields.append("éªŒè¯ç ï¼ˆcodeï¼‰")

        # æ”¶é›†æ•°æ®ä¸­å®é™…å‡ºç°çš„å°ç»„
        groups_in_data = []
        seen_groups = set()
        for user_info in self.user_ids:
            g = user_info.get('group')
            if g not in seen_groups:
                seen_groups.add(g)
                groups_in_data.append(g)

        # è§£ææ¯ä¸ªå°ç»„çš„å¤š Cookieï¼ˆè‹±æ–‡é€—å·åˆ†éš”ï¼‰
        group_tokens = {}  # dict[group] -> List[token]
        for group in groups_in_data:
            token_input = self.token_inputs.get(group)
            raw = token_input.text().strip() if token_input else ""
            tokens = [t.strip() for t in raw.split(",") if t.strip()]
            if not tokens:
                missing_fields.append(f"å°ç»„ {group} çš„ Cookie")
            else:
                # å»é‡ï¼Œä¿åº
                dedup, _seen = [], set()
                for t in tokens:
                    if t not in _seen:
                        _seen.add(t)
                        dedup.append(t)
                group_tokens[group] = dedup

        if missing_fields:
            QMessageBox.warning(self, "è¾“å…¥é”™è¯¯", "è¯·å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š\n" + "\n".join(sorted(set(missing_fields))))
            return

        # æ—¶é—´æ ¡éªŒä¸è½¬æ¢
        start = self.start_time_input.dateTime().toString("yyyy-MM-dd HH:mm:ss")
        end = self.end_time_input.dateTime().toString("yyyy-MM-dd HH:mm:ss")
        if end < start:
            QMessageBox.warning(self, 'è­¦å‘Š', 'ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´')
            return

        self.start_timestamp = int(datetime.strptime(start, '%Y-%m-%d %H:%M:%S').timestamp())
        self.end_timestamp = int(datetime.strptime(end, '%Y-%m-%d %H:%M:%S').timestamp())
        self.port = port
        self.code = code

        # UI åˆå§‹åŒ–
        total = len(self.user_ids)
        self.status_label.setText(f"çŠ¶æ€ï¼šæ­£åœ¨è·å–æ•°æ® (0/{total})")
        self.progress_bar.setMaximum(total)
        self.progress_bar.setValue(0)
        self.progress_bar.setVisible(True)

        # ç¦ç”¨ç›¸å…³æŒ‰é’®
        self.file_button.setEnabled(False)
        self.start_time_input.setEnabled(False)
        self.end_time_input.setEnabled(False)
        self.get_button.setEnabled(False)
        self.export_button.setEnabled(False)
        self.prev_day_btn.setEnabled(False)
        self.today_btn.setEnabled(False)
        self.next_day_btn.setEnabled(False)

        # â€”â€” é¢„åˆ†ç‰‡ï¼šæŒ‰ç»„æŠŠç”¨æˆ·è½®è¯¢åˆ†åˆ°å„è‡ª Cookie å­é˜Ÿåˆ—ï¼ˆæ— é”ï¼‰ â€”â€”
        # 1) æŒ‰ç»„èšåˆç”¨æˆ·
        group_users = {g: [] for g in group_tokens.keys()}
        for user_info in self.user_ids:
            g = user_info.get('group')
            uid = user_info.get('user_id')
            if g in group_users:
                group_users[g].append(uid)

        # 2) å¯¹æ¯ç»„ï¼ŒæŒ‰ç…§è¯¥ç»„ token æ•°é‡è½®è¯¢åˆ†é…
        per_cookie_queues = {}  # key: (group, token) -> deque
        for g, tokens in group_tokens.items():
            n = len(tokens)
            if n == 0:
                continue
            # åˆå§‹åŒ–æ¯ä¸ª token å¯¹åº”çš„é˜Ÿåˆ—
            token_deques = [deque() for _ in range(n)]
            # è½®è¯¢æŠŠè¯¥ç»„çš„è´¦å·åˆ†å‘åˆ°å„ token
            users = group_users.get(g, [])
            for idx, uid in enumerate(users):
                token_deques[idx % n].append(uid)
            # åªä¸ºéç©ºé˜Ÿåˆ—åˆ›å»º workerï¼ˆç©ºçš„å°±ä¸å¯åŠ¨ï¼‰
            for i, tk in enumerate(tokens):
                dq = token_deques[i]
                if dq:
                    per_cookie_queues[(g, tk)] = dq

        # å¹¶å‘æ§åˆ¶å­—æ®µ
        self.paused = False
        self.total_done = 0

        # â€”â€” å¯åŠ¨ï¼šä¸€ Cookie ä¸€ä¸ªçº¿ç¨‹ â€”â€”
        self._workers = []
        self._workers_total = len(per_cookie_queues)
        self._workers_done = 0

        # è‹¥æ²¡æœ‰ä»»ä½•ä»»åŠ¡é˜Ÿåˆ—ï¼ˆä¾‹å¦‚æ‰€æœ‰ç»„éƒ½æ²¡æœ‰ç”¨æˆ·ï¼‰ï¼Œç›´æ¥æ”¶å°¾
        if self._workers_total == 0:
            self.on_scheduler_finished()
            return

        def _on_worker_thread_finished():
            # æ¯ä¸ªçº¿ç¨‹è‡ªç„¶ç»“æŸæ—¶ç»Ÿè®¡
            self._workers_done += 1
            if self._workers_done >= self._workers_total:
                # æ‰€æœ‰çº¿ç¨‹ç»“æŸ -> ç»Ÿä¸€æ”¶å°¾
                self.on_scheduler_finished()

        for (g, tk), dq in per_cookie_queues.items():
            w = CookieWorker(
                owner=self,
                group=g,
                token=tk,
                queue_deque=dq,
                port=self.port,
                code=self.code,
                start_ts=self.start_timestamp,
                end_ts=self.end_timestamp
            )
            w.finished.connect(_on_worker_thread_finished, Qt.QueuedConnection)
            self._workers.append(w)

        # å¯é€‰ï¼šè¿™é‡Œå¯ä»¥æ‰“å°ä¸€ä¸‹å¹¶å‘è§„æ¨¡
        # print(f"å¯åŠ¨ {len(self._workers)} ä¸ª Cookie çº¿ç¨‹ï¼Œå…± {total} ä¸ªè´¦å·")

        for w in self._workers:
            w.start()

    # ===== æ›¿æ¢ï¼š_resume_after_pauseï¼ˆæ²¿ç”¨ä½ çš„æš‚åœ/æ¢å¤UIæç¤ºï¼‰=====
    def _resume_after_pause(self):
        """æš‚åœç»“æŸåæ¢å¤æ´¾å‘ï¼ˆä¾› QTimer å›è°ƒä½¿ç”¨ï¼‰"""
        self.paused = False
        # CookieWorker ä¼šåœ¨ä¸‹ä¸€è½®è‡ªåŠ¨ç»§ç»­ï¼›æ— éœ€æ‰‹åŠ¨è§¦å‘

    # ===== æ›¿æ¢ï¼štask_finishedï¼ˆå¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œç»Ÿè®¡/æš‚åœé€»è¾‘ä¿æŒä¸å˜ï¼‰=====
    def task_finished(self, result):
        """å•ä¸ªè´¦å·ä»»åŠ¡å®Œæˆå›è°ƒï¼ˆç”± DataWorker.signals.finished å‘å‡ºï¼‰"""
        self.completed_tasks.append(result)

        # è®¡æ•°
        self.total_done += 1

        # æ›´æ–°è¿›åº¦
        progress = len(self.completed_tasks)
        total = len(self.user_ids)
        self.progress_bar.setValue(progress)
        self.status_label.setText(f"çŠ¶æ€ï¼šæ­£åœ¨è·å–æ•°æ® ({progress}/{total})")

        # æ¯ 3000 ä¸ªæš‚åœ 5~10 ç§’ï¼ˆé¿å¼€ 0 æ¬¡ï¼‰ï¼Œå…¨å±€æš‚åœï¼Œæ‰€æœ‰ CookieWorker æ„ŸçŸ¥
        if (self.total_done > 0) and (self.total_done % 3000 == 0) and not self.paused:
            pause_seconds = random.randint(5, 10)
            self.paused = True
            self.status_label.setText(f"çŠ¶æ€ï¼šå·²å¤„ç†{self.total_done}ä¸ªï¼Œæš‚åœ{pause_seconds}ç§’ç¼“è§£å‹åŠ›...")
            QTimer.singleShot(pause_seconds * 1000, self._resume_after_pause)

        # **ä¸åœ¨è¿™é‡Œæ”¶å°¾**ï¼šç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸï¼ˆon_scheduler_finishedï¼‰

    # ===== æ›¿æ¢ï¼šè°ƒåº¦çº¿ç¨‹ç»“æŸæ—¶çš„ç»Ÿä¸€æ”¶å°¾ï¼ˆç°åœ¨ä»£è¡¨â€œæ‰€æœ‰ Cookie çº¿ç¨‹ç»“æŸâ€ï¼‰=====
    def on_scheduler_finished(self):
        """æ‰€æœ‰ Cookie çº¿ç¨‹é€€å‡ºåè°ƒç”¨ï¼Œç»Ÿä¸€æ¢å¤ UI"""
        total = len(self.user_ids)
        progress = len(self.completed_tasks)

        # éšè—è¿›åº¦æ¡ & æç¤º
        if progress >= total:
            self.status_label.setText("çŠ¶æ€ï¼šæ‰€æœ‰æ•°æ®å·²è·å–å®Œæˆï¼")
            self.progress_bar.setVisible(False)
            QMessageBox.information(self, "æç¤º", "æ‰€æœ‰æ•°æ®å·²è·å–å®Œæˆï¼")
        else:
            self.status_label.setText(f"çŠ¶æ€ï¼šä»»åŠ¡ç»“æŸï¼ˆå®Œæˆ {progress}/{total}ï¼‰")

        # æ¢å¤æŒ‰é’®
        self.file_button.setEnabled(True)
        self.start_time_input.setEnabled(True)
        self.end_time_input.setEnabled(True)
        self.get_button.setEnabled(True)
        self.export_button.setEnabled(True)
        self.prev_day_btn.setEnabled(True)
        self.today_btn.setEnabled(True)
        self.next_day_btn.setEnabled(True)

    def export_data(self):  # å¯¼å‡ºæ•°æ®åˆ°Excelæ–‡ä»¶
        if not self.completed_tasks:
            QMessageBox.warning(self, "è­¦å‘Š", "æ²¡æœ‰æ•°æ®å¯å¯¼å‡ºï¼")
            return

        try:
            wb = Workbook()
            ws = wb.active
            ws.append(['APPID', 'æœ‰æ•ˆæŠ•æ³¨', 'å…¶ä»–ä¿¡æ¯', 'æ³¨å†ŒIP', 'æœ€åç™»å½•IP', 'æ³¨å†Œæ—¶é—´', 'æœ€åç™»å½•æ—¶é—´', 'æå……å®¢æŸ',
                       'å……å€¼', 'æç°', 'æ¸¸æˆæŸç›Š', 'æ¸¸æˆID', 'æ¸ é“ä¿¡æ¯'])  # æ›´æ–°è¡¨å¤´

            for task in self.completed_tasks:
                parts = task.split(", ")
                # ä½¿ç”¨é»˜è®¤å€¼å¤„ç†å¯èƒ½ç¼ºå¤±çš„æ•°æ®
                æ¸¸æˆid = self.convert_to_number(parts[0]) if len(parts) > 0 else "æ— æ•°æ®"
                æœ‰æ•ˆæŠ•æ³¨ = self.convert_to_number(parts[1]) if len(parts) > 1 else "æ— æ•°æ®"
                å…¶ä»–ä¿¡æ¯ = parts[2] if len(parts) > 2 else "æ— æ•°æ®"  # åˆå¹¶çš„å…¶ä»–ä¿¡æ¯
                æ³¨å†ŒIP = parts[3] if len(parts) > 3 else "æ— æ•°æ®"
                æœ€åç™»å½•IP = parts[4] if len(parts) > 4 else "æ— æ•°æ®"
                æ³¨å†Œæ—¶é—´ = parts[5] if len(parts) > 5 else "æ— æ•°æ®"
                æœ€åç™»å½•æ—¶é—´ = parts[6] if len(parts) > 6 else "æ— æ•°æ®"
                æå……å®¢æŸ = self.convert_to_number(parts[7]) if len(parts) > 7 else "æ— æ•°æ®"
                å……å€¼ = self.convert_to_number(parts[8]) if len(parts) > 8 else "æ— æ•°æ®"
                æç° = self.convert_to_number(parts[9]) if len(parts) > 9 else "æ— æ•°æ®"
                æ¸¸æˆæŸç›Š = self.convert_to_number(parts[10]) if len(parts) > 10 else "æ— æ•°æ®"
                APPID = self.convert_to_number(parts[11]) if len(parts) > 11 else "æ— æ•°æ®"
                æ¸ é“ä¿¡æ¯ = parts[12] if len(parts) > 12 else "æ— æ•°æ®"  # åˆå¹¶çš„æ¸ é“ä¿¡æ¯

                # æ›´æ–°æ•°æ®è¡Œ
                ws.append(
                    [APPID, æœ‰æ•ˆæŠ•æ³¨, å…¶ä»–ä¿¡æ¯, æ³¨å†ŒIP, æœ€åç™»å½•IP, æ³¨å†Œæ—¶é—´, æœ€åç™»å½•æ—¶é—´, æå……å®¢æŸ,
                     å……å€¼, æç°, æ¸¸æˆæŸç›Š, æ¸¸æˆid, æ¸ é“ä¿¡æ¯])

            current_time = datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥%Hæ—¶%Måˆ†%Sç§’")
            filename = f"å¤§æ•°æ®_{current_time}.xlsx"
            wb.save(filename)
            QMessageBox.information(self, "æç¤º", f"å¤§æ•°æ®å·²å¯¼å‡ºåˆ° {filename}")
            os.startfile(filename)

        except Exception as e:
            QMessageBox.critical(self, "å¯¼å‡ºé”™è¯¯", f"å¯¼å‡ºæ•°æ®æ—¶å‘ç”Ÿé”™è¯¯: {str(e)}")

    def convert_to_number(self, value):  # å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œå¦‚æœè½¬æ¢å¤±è´¥åˆ™è¿”å›"æ— æ•°æ®"
        try:
            return float(value)  # å°è¯•å°†å€¼è½¬æ¢ä¸ºæµ®ç‚¹æ•°
        except ValueError:
            return "æ— æ•°æ®"  # è½¬æ¢å¤±è´¥æ—¶è¿”å›"æ— æ•°æ®"

    def load_group_names_from_config(self):
        config = ConfigParser()
        config.read('config.ini', encoding='utf-8')
        if 'GROUP_COOKIES' in config:
            return list(config['GROUP_COOKIES'].keys())
        # é»˜è®¤ç»„ï¼ˆé¦–æ¬¡è¿è¡Œæˆ– config.ini å°šä¸å­˜åœ¨ï¼‰
        return ["lvcha", "yaoji", "sejie", "aisebo", "xingf", "shaonv", "renqi", "lemi", 'cshuang']

    def save_config(self, port, token_dict, code):
        config = ConfigParser()

        # ä¿å­˜é€šç”¨é…ç½®
        config['COMMON'] = {
            'Port': port,
            'Code': code
        }

        # ä¿å­˜å°ç»„Cookieåˆ°ç»Ÿä¸€åˆ†åŒºï¼ˆå·²åœ¨ manual_save é‡Œåšè¿‡è§„èŒƒåŒ–ï¼Œè¿™é‡Œç›´æ¥ä¿å­˜ï¼‰
        config['GROUP_COOKIES'] = {group: token for group, token in token_dict.items()}

        with open('config.ini', 'w', encoding='utf-8') as configfile:
            config.write(configfile)

    def load_config(self):
        config = ConfigParser()
        config.read('config.ini', encoding='utf-8')

        if 'COMMON' in config:
            self.port_input.setText(config['COMMON'].get('Port', ''))
            self.code_input.setText(config['COMMON'].get('Code', ''))

        if 'GROUP_COOKIES' in config:
            for group, token in config['GROUP_COOKIES'].items():
                if group in self.token_inputs:
                    # è¿™é‡Œç›´æ¥å›å¡«ä¿å­˜æ—¶çš„å­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ˜¯ "cookie1,cookie2"ï¼‰
                    self.token_inputs[group].setText(token)

    def manual_save(self):  # æ‰‹åŠ¨ä¿å­˜é…ç½®ï¼ˆæ”¯æŒä¸­æ–‡é€—å·->è‹±æ–‡é€—å·ã€å»é‡ã€å»ç©ºæ ¼ã€å»ç©ºé¡¹ï¼‰
        port = self.port_input.text().strip()
        code = self.code_input.text().strip()

        token_dict = {}
        missing_groups = []

        for group, input_field in self.token_inputs.items():
            raw = input_field.text().strip()

            # --- ä¿®æ”¹ç‚¹ï¼šè‡ªåŠ¨æŠŠä¸­æ–‡é€—å·æ›¿æ¢ä¸ºè‹±æ–‡é€—å· ---
            raw = raw.replace("ï¼Œ", ",")

            # æ‹†åˆ†ã€å»ç©ºæ ¼ã€å»ç©ºé¡¹
            parts = [p.strip() for p in raw.split(",") if p.strip()]

            # å»é‡ï¼ˆä¿æŒé¡ºåºï¼‰
            seen = set()
            tokens = []
            for p in parts:
                if p not in seen:
                    seen.add(p)
                    tokens.append(p)

            if tokens:
                # è§„èŒƒåŒ–åå†å›å¡«åˆ°è¾“å…¥æ¡†ï¼ˆç”¨æˆ·ä¸€çœ¼èƒ½çœ‹åˆ°è¢«æ¸…æ´—åçš„ç»“æœï¼‰
                normalized = ",".join(tokens)
                input_field.setText(normalized)
                token_dict[group] = normalized
                input_field.setStyleSheet("")  # æ¸…é™¤çº¢æ¡†
            else:
                # è¯¥ç»„ä¸ºç©ºï¼šæ ‡çº¢æç¤º
                missing_groups.append(group)
                input_field.setStyleSheet("border: 1px solid red;")

        if not port or not code:
            QMessageBox.warning(self, "è­¦å‘Š", "è¯·å¡«å†™å®Œæ•´çš„é…ç½®ï¼ˆportå’Œcodeï¼‰ï¼")
            return

        # ä¿å­˜ï¼ˆè§„èŒƒåŒ–åçš„ token_dictï¼‰
        self.save_config(port, token_dict, code)

        if missing_groups:
            missing_text = "ã€".join(missing_groups)
            QMessageBox.information(self, "éƒ¨åˆ†ä¿å­˜æˆåŠŸ", f"é…ç½®å·²ä¿å­˜ï¼Œä½†ä»¥ä¸‹å°ç»„æœªå¡«å†™ Cookieï¼š{missing_text}")
        else:
            QMessageBox.information(self, "æç¤º", "âœ… é…ç½®å·²å®Œæ•´ä¿å­˜ï¼")


if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = UserWindow()
    window.show()
    sys.exit(app.exec_())
